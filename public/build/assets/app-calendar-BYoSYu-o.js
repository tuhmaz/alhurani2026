document.addEventListener("DOMContentLoaded",function(){const N=isRtl?"rtl":"ltr";(function(){const F=document.getElementById("calendar"),T=document.querySelector(".app-calendar-sidebar"),w=document.getElementById("addEventSidebar"),k=document.querySelector(".app-overlay"),g=document.querySelector(".offcanvas-title"),D=document.querySelector(".btn-toggle-sidebar"),n=document.querySelector(".btn-add-event"),f=document.querySelector(".btn-delete-event"),q=document.querySelector(".btn-cancel"),v=document.getElementById("eventTitle"),o=document.getElementById("eventStartDate"),b=document.getElementById("eventEndDate"),V=document.getElementById("eventURL"),A=document.getElementById("eventLocation"),h=document.getElementById("eventDescription"),E=document.querySelector(".allDay-switch"),C=document.querySelector(".select-all"),R=Array.from(document.querySelectorAll(".input-filter")),Y=document.querySelector(".inline-calendar"),U={Business:"primary",Holiday:"success",Personal:"danger",Family:"warning",ETC:"info"},I=$("#eventLabel"),m=$("#eventGuests");let p=[],y=!1,a=null,S=null;const c=w?new bootstrap.Offcanvas(w):null;//! TODO: Update Event label and guest code to JS once select removes jQuery dependency
if(I.length){let e=function(t){if(!t.id)return t.text;var i="<span class='badge badge-dot bg-"+$(t.element).data("label")+" me-2'> </span>"+t.text;return i};var J=e;I.wrap('<div class="position-relative"></div>').select2({placeholder:"Select value",dropdownParent:I.parent(),templateResult:e,templateSelection:e,minimumResultsForSearch:-1,escapeMarkup:function(t){return t}})}if(m.length){let e=function(t){return t.id?`
    <div class='d-flex flex-wrap align-items-center'>
      <div class='avatar avatar-xs me-2'>
        <img src='${assetsPath}img/avatars/${$(t.element).data("avatar")}'
          alt='avatar' class='rounded-circle' />
      </div>
      ${t.text}
    </div>`:t.text};var z=e;m.wrap('<div class="position-relative"></div>').select2({placeholder:"Select value",dropdownParent:m.parent(),closeOnSelect:!1,templateResult:e,templateSelection:e,escapeMarkup:function(t){return t}})}if(o)var M=o.flatpickr({monthSelectorType:"static",static:!0,enableTime:!0,altFormat:"Y-m-dTH:i:S",onReady:function(e,t,i){i.isMobile&&i.mobileInput.setAttribute("step",null)}});if(b)var P=b.flatpickr({monthSelectorType:"static",static:!0,enableTime:!0,altFormat:"Y-m-dTH:i:S",onReady:function(e,t,i){i.isMobile&&i.mobileInput.setAttribute("step",null)}});Y&&(S=Y.flatpickr({monthSelectorType:"static",static:!0,inline:!0}));function G(e){a=e.event,a.url&&(e.jsEvent.preventDefault(),window.open(a.url,"_blank")),c&&c.show(),g&&(g.innerHTML="Update Event"),n&&(n.innerHTML="Update",n.classList.add("btn-update-event"),n.classList.remove("btn-add-event")),f&&f.classList.remove("d-none"),v&&(v.value=a.title||""),typeof M<"u"&&M&&M.setDate(a.start,!0,"Y-m-d"),E&&(a.allDay===!0?E.checked=!0:E.checked=!1),typeof P<"u"&&P&&(a.end!==null?P.setDate(a.end,!0,"Y-m-d"):P.setDate(a.start,!0,"Y-m-d")),I.val(a.extendedProps.calendar).trigger("change"),A&&a.extendedProps.location!==void 0&&(A.value=a.extendedProps.location),a.extendedProps.guests!==void 0&&m.val(a.extendedProps.guests).trigger("change"),h&&a.extendedProps.description!==void 0&&(h.value=a.extendedProps.description)}function B(){const e=document.querySelector(".fc-sidebarToggle-button");if(e){for(e.classList.remove("fc-button-primary"),e.classList.add("d-lg-none","d-inline-block","ps-0");e.firstChild;)e.firstChild.remove();e.setAttribute("data-bs-toggle","sidebar"),e.setAttribute("data-overlay",""),e.setAttribute("data-target","#app-calendar-sidebar"),e.insertAdjacentHTML("beforeend",'<i class="icon-base ti tabler-menu-2 icon-lg text-heading"></i>')}}function j(e,t){const i=document.getElementById("select-database"),r=i?i.value:window.appCalendar&&window.appCalendar.currentDatabase||null,s=new URLSearchParams;r&&s.append("database",r),e&&e.startStr&&s.append("start",e.startStr),e&&e.endStr&&s.append("end",e.endStr),fetch(`/dashboard/calendar-events?${s.toString()}`,{headers:{Accept:"application/json"}}).then(l=>l.json()).then(l=>{l&&l.status==="success"?(p=l.data||[],t(p)):t([])}).catch(()=>t([]))}if(!F)return;let d=new Calendar(F,{initialView:"dayGridMonth",events:j,plugins:[dayGridPlugin,interactionPlugin,listPlugin,timegridPlugin],editable:!0,dragScroll:!0,dayMaxEvents:2,eventResizableFromStart:!0,customButtons:{sidebarToggle:{text:"Sidebar"}},headerToolbar:{start:"sidebarToggle, prev,next, title",end:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},direction:N,initialDate:new Date,navLinks:!0,eventClassNames:function({event:e}){return["bg-label-"+U[e._def.extendedProps.calendar]]},dateClick:function(e){let t=moment(e.date).format("YYYY-MM-DD");H(),c&&c.show(),g&&(g.innerHTML="Add Event"),n&&(n.innerHTML="Add",n.classList.remove("btn-update-event"),n.classList.add("btn-add-event")),f&&f.classList.add("d-none"),o&&(o.value=t),b&&(b.value=t)},eventClick:function(e){G(e)},datesSet:function(){B()},viewDidMount:function(){B()}});d.render(),B();const x=document.getElementById("eventForm");x&&window.FormValidation&&FormValidation.formValidation?FormValidation.formValidation(x,{fields:{eventTitle:{validators:{notEmpty:{message:"Please enter event title "}}},eventStartDate:{validators:{notEmpty:{message:"Please enter start date "}}},eventEndDate:{validators:{notEmpty:{message:"Please enter end date "}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:function(){return".form-control-validation"}}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){y=!0}).on("core.form.invalid",function(){y=!1}):(y=!0,x.addEventListener("input",()=>{y=!!(v.value&&o.value)})),D&&D.addEventListener("click",e=>{q&&q.classList.remove("d-none")});function _(e){p.push(e),d.refetchEvents()}function K(e){e.id=parseInt(e.id),p[p.findIndex(t=>t.id===e.id)]=e,d.refetchEvents()}function X(e){p=p.filter(function(t){return t.id!=e}),d.refetchEvents()}n&&n.addEventListener("click",e=>{var t,i;if(n.classList.contains("btn-add-event")){if(y){const r=document.querySelector('meta[name="csrf-token"]'),s=r?r.getAttribute("content"):"",l={title:v.value,description:h.value,event_date:o.value,eventDatabase:(t=document.getElementById("eventDatabase"))==null?void 0:t.value};n.disabled=!0,fetch("/dashboard/calendar/store",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":s},body:JSON.stringify(l)}).then(u=>u.json()).then(u=>{u&&u.status==="success"?(_(u.data),c&&c.hide()):d.refetchEvents()}).catch(()=>{d.refetchEvents()}).finally(()=>{n&&(n.disabled=!1)})}}else if(y){const r=document.querySelector('meta[name="csrf-token"]'),s=r?r.getAttribute("content"):"",l=a.id,u={title:v.value,description:h.value,event_date:o.value,eventDatabase:(i=document.getElementById("eventDatabase"))==null?void 0:i.value};n.disabled=!0,fetch(`/dashboard/calendar/${l}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":s},body:JSON.stringify(u)}).then(L=>L.json()).then(L=>{L&&L.status==="success"?(K(L.data),c.hide()):d.refetchEvents()}).catch(()=>{d.refetchEvents()}).finally(()=>{n&&(n.disabled=!1)})}}),f&&f.addEventListener("click",e=>{var l;const t=document.querySelector('meta[name="csrf-token"]'),i=t?t.getAttribute("content"):"",r=parseInt(a.id),s=(l=document.getElementById("eventDatabase"))==null?void 0:l.value;fetch(`/dashboard/calendar/${r}?database=${encodeURIComponent(s||"")}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":i}}).then(u=>u.json()).finally(()=>{X(r),c&&c.hide()})});function H(){b&&(b.value=""),V&&(V.value=""),o&&(o.value=""),v&&(v.value=""),A&&(A.value=""),E&&(E.checked=!1),m&&m.length&&m.val("").trigger("change"),h&&(h.value="")}w&&w.addEventListener("hidden.bs.offcanvas",function(){H()}),D&&D.addEventListener("click",e=>{g&&(g.innerHTML="Add Event"),n&&(n.innerHTML="Add",n.classList.remove("btn-update-event"),n.classList.add("btn-add-event")),f&&f.classList.add("d-none"),T&&T.classList.remove("show"),k&&k.classList.remove("show")}),C&&C.addEventListener("click",e=>{e.currentTarget.checked?document.querySelectorAll(".input-filter").forEach(t=>t.checked=1):document.querySelectorAll(".input-filter").forEach(t=>t.checked=0),d.refetchEvents()});const O=document.getElementById("select-database");O&&O.addEventListener("change",()=>{d.refetchEvents()}),R&&R.forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".input-filter:checked").length<document.querySelectorAll(".input-filter").length?C.checked=!1:C.checked=!0,d.refetchEvents()})}),S&&S.config&&S.config.onChange&&S.config.onChange.push(function(e){d.changeView(d.view.type,moment(e[0]).format("YYYY-MM-DD")),B(),T&&T.classList.remove("show"),k&&k.classList.remove("show")})})()});
