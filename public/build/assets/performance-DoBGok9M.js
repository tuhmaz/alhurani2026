let i={primary:"#696cff",secondary:"#8592a3",info:"#03c3ec",warning:"#ffab00"},u,d,p,l,m,h,y,b=[],S=[],C=[];const x=20;let g=!0,c=null;document.addEventListener("DOMContentLoaded",()=>{F(),v(),k(),w()});function v(){const e=document.getElementById("autoRefreshToggle");e&&(e.checked=!0,e.addEventListener("change",()=>{g=!!e.checked,g?w():M()}));const t=document.getElementById("refreshNow");t&&t.addEventListener("click",k)}function w(){M(),g&&(c=setInterval(k,5e3))}function M(){c&&(clearInterval(c),c=null)}function F(){u=new ApexCharts(document.querySelector("#cpuChart"),{chart:{height:200,type:"line",zoom:{enabled:!1},toolbar:{show:!1}},series:[{name:"CPU Usage",data:[]}],colors:[i.primary],dataLabels:{enabled:!1},stroke:{curve:"smooth",width:3},grid:{borderColor:"#f1f1f1",padding:{top:10,right:0,bottom:0,left:0}},xaxis:{categories:[],labels:{show:!1}},yaxis:{max:100,labels:{formatter:e=>`${e}%`}}}),u.render(),d=new ApexCharts(document.querySelector("#memoryChart"),{chart:{height:200,type:"donut"},series:[0,0],labels:["Used","Free"],colors:[i.primary,i.secondary],legend:{position:"bottom"}}),d.render(),p=new ApexCharts(document.querySelector("#diskChart"),{chart:{height:200,type:"donut"},series:[0,0],labels:["Used","Free"],colors:[i.warning,i.secondary],legend:{position:"bottom"}}),p.render(),l=new ApexCharts(document.querySelector("#loadChart"),{chart:{height:100,type:"area",sparkline:{enabled:!0}},series:[{name:"Load",data:[]}],colors:[i.info],fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.3}}}),l.render(),document.querySelector("#kpiCpuSparkline")&&(m=new ApexCharts(document.querySelector("#kpiCpuSparkline"),{chart:{type:"area",height:60,sparkline:{enabled:!0}},series:[{data:[]}],colors:[i.primary],stroke:{width:2,curve:"smooth"},fill:{type:"gradient",gradient:{opacityFrom:.5,opacityTo:.1}}}),m.render()),document.querySelector("#kpiMemorySparkline")&&(h=new ApexCharts(document.querySelector("#kpiMemorySparkline"),{chart:{type:"area",height:60,sparkline:{enabled:!0}},series:[{data:[]}],colors:[i.info],stroke:{width:2,curve:"smooth"},fill:{type:"gradient",gradient:{opacityFrom:.5,opacityTo:.1}}}),h.render()),document.querySelector("#kpiDiskSparkline")&&(y=new ApexCharts(document.querySelector("#kpiDiskSparkline"),{chart:{type:"area",height:60,sparkline:{enabled:!0}},series:[{data:[]}],colors:[i.warning],stroke:{width:2,curve:"smooth"},fill:{type:"gradient",gradient:{opacityFrom:.5,opacityTo:.1}}}),y.render())}async function k(){try{const e=await fetch("/dashboard/performance/metrics/data",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();B(t),$(t),q(t.time)}catch(e){console.error("Error updating metrics:",e)}}function B(e){if(u&&u.updateSeries([{name:"CPU Usage",data:[e.cpu.usage_percentage]}]),f(b,e.cpu.usage_percentage),d){const t=Number(e.memory.total)||0,o=Number(e.memory.used)||0,s=t>0?Math.min(100,Math.max(0,o/t*100)):0,a=100-s;d.updateSeries([s,a])}{const t=Number(e.memory.total)||0,o=Number(e.memory.used)||0,s=t>0?o/t*100:0;f(S,s)}if(p){const t=Number(e.disk.total)||0,o=Number(e.disk.used)||0,s=t>0?Math.min(100,Math.max(0,o/t*100)):0,a=100-s;p.updateSeries([s,a])}{const t=Number(e.disk.total)||0,o=Number(e.disk.used)||0,s=t>0?o/t*100:0;f(C,s)}l&&l.updateSeries([{name:"Load",data:e.cpu.load}]),m&&m.updateSeries([{data:b}]),h&&h.updateSeries([{data:S}]),y&&y.updateSeries([{data:C}])}function $(e){r("system-info",`${e.os} (${e.version.system})`),r("php-version",e.php_version),r("laravel-version",e.version.laravel),r("server-software",e.server_software),r("cpu-cores",e.cpu.cores),r("cpu-usage",`${e.cpu.usage_percentage.toFixed(2)}%`),r("cpu-load",e.cpu.load.map(o=>o.toFixed(2)).join(" | ")),r("cpu-cores-dup",e.cpu.cores),r("kpi-cpu",`${e.cpu.usage_percentage.toFixed(0)}%`),r("memory-total",n(e.memory.total)),r("memory-used",n(e.memory.used)),r("memory-free",n(e.memory.free)),r("memory-percentage",`${e.memory.usage_percentage}%`),r("memory-used-dup",n(e.memory.used));{const o=Number(e.memory.total)||0,s=Number(e.memory.used)||0,a=o>0?s/o*100:0;r("kpi-memory",`${a.toFixed(0)}%`)}r("disk-total",n(e.disk.total)),r("disk-used",n(e.disk.used)),r("disk-free",n(e.disk.free)),r("disk-percentage",`${e.disk.usage_percentage}%`),r("kpi-disk",`${e.disk.usage_percentage}%`);const t=document.getElementById("disk-progress");t&&(t.style.width=`${e.disk.usage_percentage}%`,t.setAttribute("aria-valuenow",`${e.disk.usage_percentage}`)),r("db-type",`${e.database.type} (${e.database.version})`),r("db-name",e.database.name),r("db-size",e.database.size),r("kpi-db-size",e.database.size),typeof e.uptime<"u"&&r("uptime",e.uptime)}function q(e){const t=new Date(e*1e3),o=document.getElementById("last-updated");if(!o)return;const s=o.querySelector("span");s?s.textContent=t.toLocaleString():o.textContent=t.toLocaleString()}function r(e,t){const o=document.getElementById(e);o&&(o.textContent=t)}function n(e){if(e===0)return"0 B";const t=1024,o=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,s)).toFixed(2))+" "+o[s]}function f(e,t){e.push(parseFloat(t.toFixed?t.toFixed(2):t)),e.length>x&&e.shift()}
