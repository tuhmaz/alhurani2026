(function(){document.addEventListener("DOMContentLoaded",function(){const h=document.getElementById("contentChart");if(!h||typeof ApexCharts>"u"){console.warn("[Dashboard] Chart container or ApexCharts not available. Skipping init.");return}const o=window.__ANALYTICS_DATA__||{};window.Apex||(window.Apex={}),window.Apex.chart||(window.Apex.chart={}),Array.isArray(window.Apex.chart.locales)&&window.Apex.chart.locales.length>0&&typeof window.Apex.chart.defaultLocale=="string"||(window.Apex.chart.locales=[{name:"en",options:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],toolbar:{exportToSVG:"Download SVG",exportToPNG:"Download PNG",exportToCSV:"Download CSV",menu:"Menu",selection:"Selection",selectionZoom:"Selection Zoom",zoomIn:"Zoom In",zoomOut:"Zoom Out",pan:"Panning",reset:"Reset Zoom"}}}],window.Apex.chart.defaultLocale="en");const d=e=>Array.isArray(e)?e:e&&typeof e=="object"&&"length"in e?Array.from(e):e?Object.values(e):[],a=e=>d(e).map(n=>n==null?0:Number(n)),r=(e,n)=>{const t=e.slice(0,n);for(;t.length<n;)t.push(0);return t},w=d(o.dates),c=w.length,p=r(a(o.articles),c),A=r(a(o.news),c),g=r(a(o.comments),c),b=r(a(o.views),c),x={series:[{name:o.i18nArticles||"Articles",data:p,type:"line"},{name:o.i18nNews||"News",data:A,type:"line"},{name:o.i18nComments||"Comments",data:g,type:"area"},{name:o.i18nViews||"Views",data:b,type:"area"}],chart:{height:350,type:"line",toolbar:{show:!0,tools:{download:!1,selection:!1,zoom:!1,zoomin:!1,zoomout:!1,pan:!1,reset:!1}},zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{width:[2,2,1,1],curve:"smooth"},colors:["#696cff","#03c3ec","#ffab00","#71dd37"],fill:{opacity:[1,1,.3,.3],type:["solid","solid","gradient","gradient"],gradient:{shade:"light",type:"vertical",opacityFrom:.4,opacityTo:.1}},legend:{position:"top",horizontalAlign:"right",offsetY:-20,labels:{colors:document.documentElement.classList.contains("dark-style")?"#fff":void 0}},markers:{size:4,hover:{size:6}},xaxis:{categories:w,labels:{style:{colors:document.documentElement.classList.contains("dark-style")?"#fff":void 0}},axisBorder:{show:!1}},yaxis:{labels:{style:{colors:document.documentElement.classList.contains("dark-style")?"#fff":void 0}}},grid:{borderColor:document.documentElement.classList.contains("dark-style")?"#3b3b3b":"#e7e7e7"},tooltip:{shared:!0,intersect:!1,y:{formatter:function(e){return typeof e<"u"?e.toFixed(0):e}}}};if(window._contentChart&&typeof window._contentChart.destroy=="function")try{window._contentChart.destroy()}catch{}const l=new ApexCharts(h,x);window._contentChart=l,requestAnimationFrame(()=>{try{const e=l.render();e&&typeof e.then=="function"&&e.catch(n=>console.error("[Dashboard] Chart render promise failed:",n))}catch(e){console.error("[Dashboard] Chart render failed:",e)}});const m=document.querySelector("#timeRangeMenu"),y=document.getElementById("timeRangeButton");m&&y&&m.addEventListener("click",function(e){if(e.target.classList.contains("dropdown-item")){e.preventDefault();const n=e.target.dataset.days;y.textContent=e.target.textContent,m.querySelectorAll(".dropdown-item").forEach(t=>t.classList.remove("active")),e.target.classList.add("active"),fetch(`/dashboard/analytics?days=${n}`).then(t=>t.json()).then(t=>{try{const s=d((t==null?void 0:t.dates)||[]),i=s.length,C=r(a((t==null?void 0:t.articles)||[]),i),S=r(a((t==null?void 0:t.news)||[]),i),L=r(a((t==null?void 0:t.comments)||[]),i),D=r(a((t==null?void 0:t.views)||[]),i);l.updateOptions({xaxis:{categories:s}}),l.updateSeries([{name:o.i18nArticles||"Articles",data:C},{name:o.i18nNews||"News",data:S},{name:o.i18nComments||"Comments",data:L},{name:o.i18nViews||"Views",data:D}])}catch(s){console.error("[Dashboard] Chart update failed:",s)}const u=s=>document.querySelector(s),f=(s,i)=>{s&&(s.textContent=i)};f(u('[data-stat="total-views"]'),t.totalViews),f(u('[data-stat="active-authors"]'),t.activeAuthors),f(u('[data-stat="total-comments"]'),t.totalComments)})}})})})();
