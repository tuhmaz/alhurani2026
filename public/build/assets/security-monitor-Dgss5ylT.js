document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".sensitive-data").forEach(function(e){["copy","paste","cut"].forEach(function(i){e.addEventListener(i,function(a){a.preventDefault()})})}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),document.querySelectorAll("form").forEach(function(e){e.addEventListener("submit",function(i){let a=!1;e.querySelectorAll('input[type="text"], textarea').forEach(function(s){/<script[^>]*>|<\/script>|javascript:|data:|<script|\beval\b|\bexec\b|\balert\b|\bprompt\b/i.test(s.value)&&(a=!0,s.classList.add("is-invalid"))}),a&&(i.preventDefault(),toastr.error("تم اكتشاف محتوى غير آمن في النموذج"))})}),document.querySelectorAll("[data-requires-permission]").forEach(function(e){e.addEventListener("click",function(i){e.dataset.hasPermission||(i.preventDefault(),$.post("/dashboard/security/log-unauthorized-access",{element:e.dataset.requiresPermission,url:window.location.href}),toastr.error("ليس لديك صلاحية للوصول إلى هذا العنصر"))})});var n={chart:{height:260,type:"radialBar"},plotOptions:{radialBar:{hollow:{size:"70%"},track:{background:"#f0f2f5"},dataLabels:{show:!1}}},colors:["#28c76f"],fill:{type:"gradient",gradient:{shade:"dark",type:"horizontal",shadeIntensity:.5,gradientToColors:["#00cfe8"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},series:[window.securityScore||0],stroke:{lineCap:"round"}},t=new ApexCharts(document.querySelector("#security-score-chart"),n);t.render();var r=window.timelineTrends||{dates:[],critical:[],warning:[]},c={chart:{height:370,type:"area",toolbar:{show:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:3},series:[{name:"أحداث حرجة",data:r.critical},{name:"تحذيرات",data:r.warning}],colors:["#ea5455","#ff9f43"],fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.2,stops:[0,90,100]}},xaxis:{categories:r.dates,labels:{style:{cssClass:"text-muted"}}},yaxis:{labels:{style:{cssClass:"text-muted"}}},tooltip:{x:{format:"dd/MM/yy"}},legend:{position:"top",horizontalAlign:"right"}},l=new ApexCharts(document.querySelector("#security-events-timeline"),c);l.render();var o=[],d=[];window.eventTypeDistribution&&window.eventTypeDistribution.length>0?window.eventTypeDistribution.forEach(e=>{o.push(e.event_type),d.push(e.count)}):(o=[],d=[]);var u={chart:{height:370,type:"donut"},labels:o,series:d,colors:["#ea5455","#ff9f43","#28c76f","#00cfe8","#7367f0","#82868b"],legend:{position:"bottom",fontSize:"14px"},dataLabels:{enabled:!1},plotOptions:{pie:{donut:{labels:{show:!0,name:{show:!0,fontSize:"16px",fontWeight:600},value:{show:!0,fontSize:"18px",fontWeight:700},total:{show:!0,label:"الإجمالي",fontSize:"14px",fontWeight:600,formatter:function(e){return e.globals.seriesTotals.reduce((i,a)=>i+a,0)}}}}}}},f=new ApexCharts(document.querySelector("#event-type-chart"),u);f.render(),document.querySelectorAll(".dropdown-item").forEach(function(e){e.querySelector(".ti-info-circle")&&e.addEventListener("click",function(i){i.preventDefault();var a=this.closest("tr"),s=a.querySelector("td:first-child .badge").textContent,p=a.querySelector("td:nth-child(3)").textContent,h=a.querySelector("td:nth-child(4)").textContent;$("#securityDetailModal").modal("show"),$("#securityDetailTitle").text("تفاصيل المشكلة: "+s),$("#securityDetailDescription").text(p),$("#securityDetailRecommendation").text(h)})})});$(function(){$(".security-card").each(function(n){$(this).css("animation-delay",n*.1+"s")}),$('[data-bs-toggle="tooltip"]').tooltip(),$(".btn-wave").on("click",function(n){let t=$(this).find(".wave");t.length===0&&(t=$('<span class="wave"></span>'),$(this).append(t)),t.removeClass("animate"),t.addClass("animate"),setTimeout(()=>t.removeClass("animate"),1e3)}),$("#securityDetailModal").on("show.bs.modal",function(n){const t=$(n.relatedTarget),r=t.data("type"),c=t.data("description"),l=t.data("recommendation"),o=$(this);o.find("#securityDetailTitle").text("تفاصيل المشكلة: "+r),o.find("#securityDetailDescription").text(c),o.find("#securityDetailRecommendation").text(l)}),$("#fixIssueBtn").on("click",function(){Swal.fire({title:"جاري معالجة المشكلة",text:"يرجى الانتظار...",icon:"info",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:()=>{Swal.showLoading()}}).then(()=>{Swal.fire({title:"تمت المعالجة بنجاح!",text:"تم معالجة المشكلة الأمنية بنجاح وتحسين درجة الأمان",icon:"success",confirmButtonText:"تم"})}),$("#securityDetailModal").modal("hide")})});
