document.addEventListener("DOMContentLoaded",function(){(function(){const c=(t,l={wheelPropagation:!1,suppressScrollX:!0})=>{t&&new PerfectScrollbar(t,l)},e={emailList:document.querySelector(".email-list"),emailListItems:Array.from(document.querySelectorAll(".email-list-item")),emailListItemInputs:Array.from(document.querySelectorAll(".email-list-item-input")),emailView:document.querySelector(".app-email-view-content"),emailFilters:document.querySelector(".email-filters"),emailFilterByFolders:Array.from(document.querySelectorAll(".email-filter-folders li")),emailEditor:document.querySelector(".email-editor"),appEmailSidebar:document.querySelector(".app-email-sidebar"),appOverlay:document.querySelector(".app-overlay"),emailReplyEditor:document.querySelector(".email-reply-editor"),bookmarkEmail:Array.from(document.querySelectorAll(".email-list-item-bookmark")),selectAllEmails:document.getElementById("email-select-all"),emailSearch:document.querySelector(".email-search-input"),toggleCC:document.querySelector(".email-compose-toggle-cc"),toggleBCC:document.querySelector(".email-compose-toggle-bcc"),emailCompose:document.querySelector(".app-email-compose"),emailListDelete:document.querySelector(".email-list-delete"),emailListRead:document.querySelector(".email-list-read"),emailListEmpty:document.querySelector(".email-list-empty"),refreshEmails:document.querySelector(".email-refresh"),emailViewContainer:document.getElementById("app-email-view"),emailFilterFolderLists:Array.from(document.querySelectorAll(".email-filter-folders li")),emailListItemActions:Array.from(document.querySelectorAll(".email-list-item-actions li"))};c(e.emailList),c(e.emailFilters),c(e.emailView);const d=(t,l)=>{t&&new Quill(t,{modules:{toolbar:l},placeholder:"Message",theme:"snow"})};d(e.emailEditor,".email-editor-toolbar"),d(e.emailReplyEditor,".email-reply-toolbar"),e.bookmarkEmail.forEach(t=>{t.addEventListener("click",l=>{const i=l.currentTarget.closest(".email-list-item");l.stopPropagation(),i.hasAttribute("data-starred")?i.removeAttribute("data-starred"):i.setAttribute("data-starred","true")})}),e.selectAllEmails&&e.selectAllEmails.addEventListener("click",t=>{e.emailListItemInputs.forEach(l=>{l.checked=t.currentTarget.checked})}),e.emailListItemInputs&&e.emailListItemInputs.forEach(t=>{t.addEventListener("click",l=>{l.stopPropagation();const i=e.emailListItemInputs.filter(r=>r.checked).length,a=e.emailListItemInputs.length;e.selectAllEmails.indeterminate=i>0&&i<a,e.selectAllEmails.checked=i===a})}),e.emailSearch&&e.emailSearch.addEventListener("keyup",t=>{const l=t.currentTarget.value.toLowerCase(),i=document.querySelector(".email-filter-folders .active"),a=i?i.getAttribute("data-target"):"inbox";(a!=="inbox"?Array.from(document.querySelectorAll(`.email-list-item[data-${a}="true"]`)):e.emailListItems).forEach(n=>{const f=n.textContent.toLowerCase();n.classList.toggle("d-block",f.includes(l)),n.classList.toggle("d-none",!f.includes(l))})}),e.emailFilterByFolders.forEach(t=>{t.addEventListener("click",l=>{const i=l.currentTarget.getAttribute("data-target");e.appEmailSidebar.classList.remove("show"),e.appOverlay.classList.remove("show"),e.emailFilterByFolders.forEach(a=>a.classList.remove("active")),l.currentTarget.classList.add("active"),e.emailListItems.forEach(a=>{const r=i==="inbox"||a.hasAttribute(`data-${i}`);a.classList.toggle("d-block",r),a.classList.toggle("d-none",!r)})})});const u=t=>{const l=document.querySelector(t);l&&(l.classList.toggle("d-block"),l.classList.toggle("d-none"))};if(e.toggleBCC&&e.toggleBCC.addEventListener("click",()=>u(".email-compose-bcc")),e.toggleCC&&e.toggleCC.addEventListener("click",()=>u(".email-compose-cc")),e.emailCompose&&e.emailCompose.addEventListener("hidden.bs.modal",()=>{const t=document.querySelector(".email-editor .ql-editor");t&&(t.innerHTML="");const l=document.getElementById("emailContacts");l&&(l.value=""),p()}),e.emailListDelete&&e.emailListDelete.addEventListener("click",()=>{e.emailListItemInputs.forEach(t=>{t.checked&&t.closest("li.email-list-item").remove()}),e.selectAllEmails.indeterminate=!1,e.selectAllEmails.checked=!1,e.emailListItems.length===0&&e.emailListEmpty.classList.remove("d-none")}),e.emailListRead&&e.emailListRead.addEventListener("click",()=>{e.emailListItemInputs.forEach(t=>{if(t.checked){t.checked=!1;const l=t.closest("li.email-list-item");l.classList.add("email-marked-read");const i=l.querySelector(".email-list-item-actions li");i.classList.replace("email-read","email-unread"),i.querySelector("i").classList.replace("tabler-mail-opened","tabler-mail")}}),e.selectAllEmails.indeterminate=!1,e.selectAllEmails.checked=!1}),e.refreshEmails&&e.emailList){const t=".email-list",l=new PerfectScrollbar(e.emailList,{wheelPropagation:!1,suppressScrollX:!0});e.refreshEmails.addEventListener("click",()=>{Block.standard(t,{backgroundColor:"rgba("+window.Helpers.getCssVar("black-rgb")+", 0.1)",svgSize:"0px"});const i=document.createElement("div");i.classList.add("spinner-border","text-primary"),i.setAttribute("role","status");const a=document.querySelector(".email-list .notiflix-block");a&&a.appendChild(i),setTimeout(()=>{l.settings.suppressScrollY=!1,Block.remove(t)},1e3),l.settings.suppressScrollY=!0})}const o=document.querySelector(".email-earlier-msgs");o&&o.addEventListener("click",()=>{const t=document.querySelector(".email-card-last"),l=o.nextElementSibling;t&&t.classList.add("hide-pseudo"),l&&(l.style.display=l.style.display==="none"||!l.style.display?"block":"none",l.classList.toggle("slide-toggle")),o.remove()});let m=$("#emailContacts");function p(){if(m.length){let l=function(i){return i.id?"<div class='d-flex flex-wrap align-items-center'><div class='avatar avatar-xs me-2 w-px-20 h-px-20'><img src='"+assetsPath+"img/avatars/"+$(i.element).data("avatar")+"' alt='avatar' class='rounded-circle' /></div>"+i.text+"</div>":i.text};var t=l;m.wrap('<div class="position-relative"></div>').select2({placeholder:"Select value",dropdownParent:m.parent(),closeOnSelect:!1,templateResult:l,templateSelection:l,escapeMarkup:function(i){return i}})}}p();const s=document.querySelector(".app-email-view-content"),L=s?s.querySelector(".scroll-to-reply"):null;L&&s&&L.addEventListener("click",()=>{s.scrollTop===0&&s.scrollTo({top:s.scrollHeight,behavior:"smooth"})}),e.emailFilterFolderLists&&e.emailFilterFolderLists.forEach(t=>{t.addEventListener("click",()=>{e.emailViewContainer&&e.emailViewContainer.classList.remove("show")})}),e.emailListItemActions&&e.emailListItemActions.forEach(t=>{t.addEventListener("click",l=>{l.stopPropagation();const i=t.closest("li.email-list-item");if(t.classList.contains("email-delete"))i.remove(),document.querySelectorAll(".email-list-item").length||e.emailListEmpty.classList.remove("d-none");else if(t.classList.contains("email-read")||t.classList.contains("email-unread")){const a=t.querySelector("i");i.classList.toggle("email-marked-read",t.classList.contains("email-read")),t.classList.toggle("email-read"),t.classList.toggle("email-unread"),a.classList.toggle("tabler-mail-opened"),a.classList.toggle("tabler-mail")}})})})()});
