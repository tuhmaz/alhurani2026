document.addEventListener("DOMContentLoaded",function(){var m,u;const l=document.getElementById("calendar");if(!l)return;const v=(m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.getAttribute("content"),d=new FullCalendar.Calendar(l,{initialView:"dayGridMonth",direction:"rtl",locale:"ar",height:800,headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},firstDay:6,buttonText:{today:"اليوم",month:"شهر",week:"أسبوع",day:"يوم",list:"قائمة"},events:function(n,c,a){var s;const r=((s=document.getElementById("select-database"))==null?void 0:s.value)||"mysql";fetch(`/dashboard/calendar-events?database=${r}&_=${new Date().getTime()}`,{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":v}}).then(e=>e.json()).then(e=>{e.status==="success"?(console.log("Raw events data:",e.data),c(e.data)):(console.error("Failed to fetch events:",e.message),a(new Error(e.message)))}).catch(e=>{console.error("Error fetching events:",e),a(e)})},eventClick:function(n){const c=new Date(n.event.start),a={weekday:"long",year:"numeric",month:"long",day:"numeric"},r=new Intl.DateTimeFormat("ar-SA",a).format(c),s=n.event.title||"حدث جديد";let e="";n.event.extendedProps&&n.event.extendedProps.description?e=n.event.extendedProps.description:n.event.description?e=n.event.description:e="لا يوجد وصف",e=e.trim()||"لا يوجد وصف";const t=document.getElementById("eventModal"),h=t.querySelector(".modal-title"),f=t.querySelector("#eventDescription"),y=t.querySelector("#eventDate"),E=t.querySelector(".btn-close");let i=null;t.addEventListener("show.bs.modal",function(){i=document.activeElement}),t.addEventListener("shown.bs.modal",function(){E.focus()}),t.addEventListener("hidden.bs.modal",function(){i&&i.focus()}),h.textContent=s,f.textContent=e,y.innerHTML=`<i class="page-icon ti tabler-calendar me-1"></i>${r}`;const p=new bootstrap.Modal(t);t.addEventListener("shown.bs.modal",function(){const o=t.querySelector(".btn-close");o&&o.focus()}),t.addEventListener("hidden.bs.modal",function(){const o=n.el;o&&o.focus()}),p.show()}});d.render(),(u=document.getElementById("select-database"))==null||u.addEventListener("change",function(){d.refetchEvents()}),setInterval(()=>d.refetchEvents(),3e4)});
