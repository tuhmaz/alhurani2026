class o{constructor(){this.charts={},this.metricsHistory={cpu:[],memory:[],responseTime:[]},this.init()}init(){this.initCharts(),this.startMetricsUpdate()}initCharts(){this.initCpuChart(),this.initMemoryChart(),this.initResponseTimeChart()}initCpuChart(){const e=document.querySelector("#cpuChart");if(!e)return;const t={series:[{name:"CPU Usage",data:[]}],chart:{type:"area",height:350,animations:{enabled:!0,easing:"linear",dynamicAnimation:{speed:1e3}},toolbar:{show:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.3}},xaxis:{type:"datetime"},yaxis:{min:0,max:100,labels:{formatter:s=>`${s}%`}},tooltip:{x:{format:"dd MMM yyyy HH:mm:ss"}}};this.charts.cpu=new ApexCharts(e,t),this.charts.cpu.render()}initMemoryChart(){const e=document.querySelector("#memoryChart");if(!e)return;const t={series:[{name:"Memory Usage",data:[]}],chart:{type:"area",height:350,animations:{enabled:!0,easing:"linear",dynamicAnimation:{speed:1e3}},toolbar:{show:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.3}},xaxis:{type:"datetime"},yaxis:{min:0,max:100,labels:{formatter:s=>`${s}%`}},tooltip:{x:{format:"dd MMM yyyy HH:mm:ss"}}};this.charts.memory=new ApexCharts(e,t),this.charts.memory.render()}initResponseTimeChart(){const e=document.querySelector("#responseTimeChart");if(!e)return;const t={series:[{name:"Response Time",data:[]}],chart:{type:"line",height:350,animations:{enabled:!0,easing:"linear",dynamicAnimation:{speed:1e3}},toolbar:{show:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},xaxis:{type:"datetime"},yaxis:{labels:{formatter:s=>`${s}ms`}},tooltip:{x:{format:"dd MMM yyyy HH:mm:ss"}}};this.charts.responseTime=new ApexCharts(e,t),this.charts.responseTime.render()}async updateMetrics(){try{const e=await fetch("/dashboard/performance/metrics");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json(),s=new Date().getTime();this.charts.cpu&&(this.metricsHistory.cpu.push({x:s,y:t.cpu.usage_percentage}),this.metricsHistory.cpu.length>20&&this.metricsHistory.cpu.shift(),this.charts.cpu.updateSeries([{data:this.metricsHistory.cpu}])),this.charts.memory&&(this.metricsHistory.memory.push({x:s,y:t.memory.usage_percentage}),this.metricsHistory.memory.length>20&&this.metricsHistory.memory.shift(),this.charts.memory.updateSeries([{data:this.metricsHistory.memory}])),this.charts.responseTime&&(this.metricsHistory.responseTime.push({x:s,y:t.response_time}),this.metricsHistory.responseTime.length>20&&this.metricsHistory.responseTime.shift(),this.charts.responseTime.updateSeries([{data:this.metricsHistory.responseTime}])),this.updateStats(t)}catch(e){console.error("Error updating metrics:",e)}}updateMetricsDisplay(e){this.updateGauge("cpu-gauge",e.cpu.usage_percentage),document.getElementById("cpu-cores").textContent=e.cpu.cores,document.getElementById("cpu-load").textContent=e.cpu.load_average.toFixed(2),this.updateGauge("memory-gauge",e.memory.usage_percentage),document.getElementById("memory-used").textContent=this.formatBytes(e.memory.used),document.getElementById("memory-total").textContent=this.formatBytes(e.memory.total),document.getElementById("memory-free").textContent=this.formatBytes(e.memory.free),this.updateGauge("disk-gauge",e.disk.usage_percentage),document.getElementById("disk-used").textContent=this.formatBytes(e.disk.used),document.getElementById("disk-total").textContent=this.formatBytes(e.disk.total),document.getElementById("disk-free").textContent=this.formatBytes(e.disk.free),document.getElementById("last-updated").textContent=new Date(e.last_updated).toLocaleString()}updateStats(e){const t={cpuUsage:document.querySelector("#cpuUsage"),memoryUsage:document.querySelector("#memoryUsage"),diskUsage:document.querySelector("#diskUsage"),uptime:document.querySelector("#uptime"),requestRate:document.querySelector("#requestRate")};t.cpuUsage&&(t.cpuUsage.textContent=`${e.cpu.usage_percentage}%`),t.memoryUsage&&(t.memoryUsage.textContent=`${e.memory.usage_percentage}%`),t.diskUsage&&(t.diskUsage.textContent=`${e.disk.usage_percentage}%`),t.uptime&&(t.uptime.textContent=this.formatUptime(e.uptime)),t.requestRate&&(t.requestRate.textContent=`${e.request_rate}/min`)}formatUptime(e){const t=Math.floor(e/86400),s=Math.floor(e%86400/3600),i=Math.floor(e%3600/60),r=[];return t>0&&r.push(`${t}d`),s>0&&r.push(`${s}h`),i>0&&r.push(`${i}m`),r.join(" ")||"0m"}startMetricsUpdate(){this.updateMetrics(),setInterval(()=>this.updateMetrics(),5e3)}}document.addEventListener("DOMContentLoaded",()=>{new o});
